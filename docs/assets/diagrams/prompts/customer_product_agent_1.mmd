flowchart TD
    Q[User Query] --> D{Query Type?}

    D -->|Exact category| PQ[product_query]
    D -->|Need/Intent| PS[product_search]
    D -->|Order history| OQ[order_query]
    D -->|Buy product| PO[place_order_sql]
    D -->|Cancel order| CO[cancel_order_sql]

    PS --> |Get prices| PQ
    PQ --> R[Return Results]

    PO --> |confirmed=false| SUM[Show Summary]
    SUM --> |User confirms| PO2[place_order_sql confirmed=true]

    CO --> |confirmed=false| SUM2[Show Order Details]
    SUM2 --> |User confirms| CO2[cancel_order_sql confirmed=true]

    classDef user fill:#dbeafe,stroke:#3b82f6,stroke-width:2px,color:#1e40af
    classDef decision fill:#fef3c7,stroke:#f59e0b,stroke-width:2px,color:#b45309
    classDef tool fill:#cffafe,stroke:#06b6d4,stroke-width:2px,color:#0e7490
    classDef output fill:#d1fae5,stroke:#10b981,stroke-width:2px,color:#065f46
    classDef confirm fill:#ede9fe,stroke:#8b5cf6,stroke-width:2px,color:#5b21b6

    class Q user
    class D decision
    class PQ,PS,OQ,PO,CO,PO2,CO2 tool
    class R output
    class SUM,SUM2 confirm
