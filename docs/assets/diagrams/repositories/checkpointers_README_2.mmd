flowchart LR
    A[User sends message] --> B{Checkpoint exists?}
    B --> |Yes| C[Load + refresh TTL]
    B --> |No| D[Create new]
    C --> E[Process message]
    D --> E
    E --> F[Save checkpoint]
    F --> G[TTL: 60 min]

    classDef user fill:#dbeafe,stroke:#3b82f6,stroke-width:2px,color:#1e40af
    classDef decision fill:#fef3c7,stroke:#f59e0b,stroke-width:2px,color:#b45309
    classDef load fill:#cffafe,stroke:#06b6d4,stroke-width:2px,color:#0e7490
    classDef create fill:#d1fae5,stroke:#10b981,stroke-width:2px,color:#065f46
    classDef process fill:#ede9fe,stroke:#8b5cf6,stroke-width:2px,color:#5b21b6
    classDef save fill:#fed7aa,stroke:#f97316,stroke-width:2px,color:#c2410c
    classDef ttl fill:#fce7f3,stroke:#ec4899,stroke-width:2px,color:#be185d

    class A user
    class B decision
    class C load
    class D create
    class E process
    class F save
    class G ttl
