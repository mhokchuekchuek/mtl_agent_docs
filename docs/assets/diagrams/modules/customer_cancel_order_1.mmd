flowchart TD
    START[Customer requests cancellation] --> GEN[LLM generates SQL statements]

    GEN --> CHECK_ORDER[1. Check order ownership]
    CHECK_ORDER --> |Query| ORDERS_TBL[(Orders)]
    ORDERS_TBL --> |order belongs to customer?| CHECK_ORDER

    CHECK_ORDER --> CHECK_STATUS[2. Check order status]
    CHECK_STATUS --> |Query| ORDERS_TBL
    ORDERS_TBL --> |current status| CHECK_STATUS

    CHECK_STATUS --> GET_DETAILS[3. Get order details]
    GET_DETAILS --> |Query| DETAILS_TBL[(OrderDetails)]
    DETAILS_TBL --> |product_id, quantity| GET_DETAILS

    GET_DETAILS --> CONFIRM{4. Customer confirmed?}

    CONFIRM --> |Not yet| SUMMARY[Return order summary]
    SUMMARY --> WAIT[Wait for confirmation]

    CONFIRM --> |Yes| UPDATE_STATUS[5. Update status to 'cancelled']
    UPDATE_STATUS --> |UPDATE| ORDERS_TBL

    UPDATE_STATUS --> RESTORE_INV[6. Restore inventory]
    RESTORE_INV --> |UPDATE quantity + N| INV_TBL[(Inventory)]

    RESTORE_INV --> SUCCESS[Success!]

    classDef start fill:#dbeafe,stroke:#3b82f6,stroke-width:2px,color:#1e40af
    classDef process fill:#cffafe,stroke:#06b6d4,stroke-width:2px,color:#0e7490
    classDef db fill:#fce7f3,stroke:#ec4899,stroke-width:2px,color:#be185d
    classDef decision fill:#fef3c7,stroke:#f59e0b,stroke-width:2px,color:#b45309
    classDef wait fill:#fed7aa,stroke:#f97316,stroke-width:2px,color:#c2410c
    classDef success fill:#d1fae5,stroke:#10b981,stroke-width:2px,color:#065f46

    class START start
    class GEN,CHECK_ORDER,CHECK_STATUS,GET_DETAILS,UPDATE_STATUS,RESTORE_INV process
    class ORDERS_TBL,DETAILS_TBL,INV_TBL db
    class CONFIRM decision
    class SUMMARY,WAIT wait
    class SUCCESS success
