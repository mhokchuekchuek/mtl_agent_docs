flowchart TD
    A[1. Get Prompt from Langfuse] --> B[2. Compile with datetime context]
    B --> C[3. LLM classifies intent]
    C --> D{4. Parse response}
    D -->|chat_history| E[Return CHAT_HISTORY]
    D -->|other| F[Return INSIGHT]

    classDef prompt fill:#dbeafe,stroke:#3b82f6,stroke-width:2px,color:#1e40af
    classDef process fill:#cffafe,stroke:#06b6d4,stroke-width:2px,color:#0e7490
    classDef decision fill:#fef3c7,stroke:#f59e0b,stroke-width:2px,color:#b45309
    classDef output fill:#d1fae5,stroke:#10b981,stroke-width:2px,color:#065f46

    class A prompt
    class B,C process
    class D decision
    class E,F output
